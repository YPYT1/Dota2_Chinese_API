#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""修复枚举成员的翻译"""

import json
import re

# 完整的单词翻译映射
WORD_MAP = {
    # 常见缩写和专有名词
    'DOTA': '',
    'HUD': 'HUD界面',
    'UI': 'UI',
    'HP': '生命值',
    'MP': '法力值',
    'XP': '经验',
    'ID': 'ID',
    'NPC': 'NPC',
    'AI': 'AI',
    'FX': '特效',
    'VFX': '视觉特效',
    'SFX': '音效',
    'LOD': '细节层次',
    'AOE': '范围效果',
    'DOT': '持续伤害',
    'DPS': '每秒伤害',
    'CD': '冷却',
    'GC': '游戏协调器',
    'VM': '视图模型',
    'ACT': '动作',
    'PATTACH': '粒子附着',
    'UF': '单位过滤',
    
    # 状态和属性
    'MODIFIER': '修饰器',
    'STATE': '状态',
    'PROPERTY': '属性',
    'ATTRIBUTE': '属性',
    'STRENGTH': '力量',
    'AGILITY': '敏捷',
    'INTELLIGENCE': '智力',
    'ALL': '全部',
    'PRIMARY': '主要',
    'INVALID': '无效',
    
    # 动作和行为
    'BEHAVIOR': '行为',
    'ACTION': '动作',
    'ACTIVITY': '活动',
    'ABILITY': '技能',
    'ATTACK': '攻击',
    'CAST': '施法',
    'CHANNEL': '持续施法',
    'TOGGLE': '切换',
    'PASSIVE': '被动',
    'ACTIVE': '主动',
    'AUTOCAST': '自动施法',
    'TARGET': '目标',
    'POINT': '点',
    'UNIT': '单位',
    'TREE': '树木',
    'RUNE': '神符',
    'DIRECTIONAL': '方向性',
    'VECTOR': '矢量',
    'IMMEDIATE': '立即',
    'HIDDEN': '隐藏',
    'NOT': '不',
    'NO': '无',
    'DONT': '不要',
    'IGNORE': '忽略',
    'SKIP': '跳过',
    
    # UI和显示
    'VISIBILITY': '可见性',
    'VISIBLE': '可见',
    'INVENTORY': '物品栏',
    'SHOP': '商店',
    'MINIMAP': '小地图',
    'SCOREBOARD': '计分板',
    'ACTIONPANEL': '动作面板',
    'HEALTH': '生命',
    'MANA': '法力',
    'GOLD': '金钱',
    'BUYBACK': '买活',
    'QUICKBUY': '快捷购买',
    'COURIER': '信使',
    'HERO': '英雄',
    'SELECTION': '选择',
    'HEADER': '标题',
    'PANEL': '面板',
    'BAR': '条',
    'BUTTON': '按钮',
    'ICON': '图标',
    'TOP': '顶部',
    'BOTTOM': '底部',
    'LEFT': '左',
    'RIGHT': '右',
    'CENTER': '中央',
    
    # 游戏元素
    'CREEP': '小兵',
    'BUILDING': '建筑',
    'TOWER': '防御塔',
    'BARRACKS': '兵营',
    'ANCIENT': '远古',
    'ROSHAN': '肉山',
    'NEUTRAL': '中立',
    'BOSS': '首领',
    'WARD': '守卫',
    'ILLUSION': '幻象',
    'SUMMONED': '召唤物',
    'DOMINATED': '被支配',
    'CLONE': '克隆',
    'PHANTOM': '幻影',
    
    # 伤害和效果
    'DAMAGE': '伤害',
    'PHYSICAL': '物理',
    'MAGICAL': '魔法',
    'PURE': '纯粹',
    'COMPOSITE': '复合',
    'HEAL': '治疗',
    'REGEN': '恢复',
    'REGENERATION': '恢复',
    'LIFESTEAL': '吸血',
    'ARMOR': '护甲',
    'EVASION': '闪避',
    'BLOCK': '格挡',
    'RESIST': '抗性',
    'REDUCTION': '减免',
    'AMPLIFY': '增强',
    'BONUS': '加成',
    'PENALTY': '惩罚',
    
    # 控制效果
    'STUN': '眩晕',
    'STUNNED': '被眩晕',
    'SILENCE': '沉默',
    'SILENCED': '被沉默',
    'ROOT': '缠绕',
    'ROOTED': '被缠绕',
    'DISARM': '缴械',
    'DISARMED': '被缴械',
    'HEX': '妖术',
    'HEXED': '被妖术',
    'BREAK': '破坏',
    'MUTE': '物品沉默',
    'MUTED': '被物品沉默',
    'FEAR': '恐惧',
    'FEARED': '被恐惧',
    'TAUNT': '嘲讽',
    'TAUNTED': '被嘲讽',
    'SLEEP': '沉睡',
    'NIGHTMARE': '噩梦',
    'NIGHTMARED': '噩梦中',
    'FREEZE': '冻结',
    'FROZEN': '被冻结',
    'BLIND': '致盲',
    'TRUESIGHT': '真视',
    'FLYING': '飞行',
    'UNSELECTABLE': '不可选中',
    'UNTARGETABLE': '不可作为目标',
    'INVULNERABLE': '无敌',
    'MAGIC': '魔法',
    'IMMUNE': '免疫',
    'INVISIBLE': '隐身',
    'PHASED': '相位',
    'PROVIDES': '提供',
    'VISION': '视野',
    'DISABLED': '被禁用',
    'ENABLED': '已启用',
    'OUT': '离开',
    'WORLD': '世界',
    'GAME': '游戏',
    'LOW': '低',
    'ATTACK': '攻击',
    'PRIORITY': '优先级',
    'SPECIALLY': '特殊',
    'DENIABLE': '可反补',
    'UNDENIABLE': '不可反补',
    'COMMAND': '命令',
    'RESTRICTED': '受限',
    'TETHERED': '被连接',
    'IGNORING': '忽略',
    'STOP': '停止',
    'DEBUFF': '减益',
    'PASSIVES': '被动技能',
    'NO': '无',
    'DRAW': '绘制',
    'SOFT': '软',
    'HARD': '硬',
    
    # 事件和通知
    'EVENT': '事件',
    'ALERT': '警报',
    'PING': '标记',
    'TEAMMATE': '队友',
    'ENEMY': '敌人',
    'DIED': '死亡',
    'KILLED': '击杀',
    'SPAWNED': '生成',
    'PURCHASED': '购买',
    'USED': '使用',
    'DROPPED': '丢弃',
    'PICKED': '拾取',
    
    # 游戏状态
    'PRE': '前',
    'POST': '后',
    'COLUMN': '列',
    'ROW': '行',
    'STAT': '统计',
    'STATS': '统计',
    'SCORE': '得分',
    'LEVEL': '等级',
    'KILLS': '击杀',
    'DEATHS': '死亡',
    'ASSISTS': '助攻',
    'LASTHITS': '正补',
    'DENIES': '反补',
    'GPM': '每分钟金钱',
    'NETWORTH': '身价',
    
    # 装备和物品
    'LOADOUT': '装备栏',
    'TYPE': '类型',
    'SLOT': '槽位',
    'WEAPON': '武器',
    'OFFHAND': '副手',
    'HEAD': '头部',
    'SHOULDER': '肩部',
    'ARMS': '手臂',
    'ARMOR': '护甲',
    'BELT': '腰带',
    'BACK': '背部',
    'GLOVES': '手套',
    'LEGS': '腿部',
    'TAIL': '尾巴',
    'MISC': '其他',
    'MOUNT': '坐骑',
    'SUMMON': '召唤物',
    'SHAPESHIFT': '变身',
    'TAUNT': '嘲讽',
    'KILL': '击杀',
    'EFFECT': '效果',
    'EFFECTS': '效果',
    'AMBIENT': '环境',
    'ABILITY': '技能',
    'PERSONA': '皮肤',
    'CUSTOM': '自定义',
    'DEFAULT': '默认',
    'TERRAIN': '地形',
    'CURSOR': '光标',
    'TELEPORT': '传送',
    'BLINK': '闪烁',
    'TRAVEL': '旅行',
    'RADIANT': '天辉',
    'DIRE': '夜魇',
    'MUSIC': '音乐',
    'ANNOUNCER': '播音员',
    'MEGA': '超级',
    'HUD': 'HUD',
    'SKIN': '皮肤',
    'LOADING': '加载',
    'SCREEN': '屏幕',
    'WEATHER': '天气',
    'EMOTICON': '表情',
    'GROUND': '地面',
    'PROJECTILE': '弹道',
    'ATTACHMENT': '附着点',
    'PORTRAIT': '头像',
    'PET': '宠物',
    'WARD': '守卫',
    'VOICE': '语音',
    'PARTICLE': '粒子',
    'START': '开始',
    'END': '结束',
    'COUNT': '数量',
    
    # 动画相关
    'IDLE': '待机',
    'WALK': '行走',
    'RUN': '奔跑',
    'SPAWN': '出生',
    'DIE': '死亡',
    'DEATH': '死亡',
    'FLINCH': '畏缩',
    'FLAIL': '挣扎',
    'VICTORY': '胜利',
    'DEFEAT': '失败',
    'RARE': '稀有',
    'CAPTURE': '捕获',
    'DENY': '反补',
    'SWIM': '游泳',
    'FLY': '飞行',
    'GESTURE': '手势',
    'CASTER': '施法者',
    'OVERRIDE': '覆盖',
    'CONSTANT': '常数',
    'REFRESH': '刷新',
    'THINK': '思考',
    'PHASE': '阶段',
    'SIMULATE': '模拟',
    'FINAL': '最终',
    'FIRST': '第一',
    'LAST': '最后',
    'ORDER': '命令',
    'FIND': '查找',
    'CLOSEST': '最近',
    'FARTHEST': '最远',
    'FORWARD': '向前',
    'REVERSE': '反向',
    'ANY': '任意',
    'EVERYTHING': '所有',
    'SOURCE': '来源',
    'ENGINE': '引擎',
    'ANIMATION': '动画',
    'SERVER': '服务器',
    'CLIENT': '客户端',
    'FRAME': '帧',
    'SCRIPT': '脚本',
    'FOOTSTEP': '脚步',
    'FIRE': '开火',
    'EMIT': '发射',
    'NEW': '新',
    'OLD': '旧',
    'MATERIAL': '材质',
    'SOUND': '音效',
    'DATA': '数据',
    'PITCH': '音调',
    'RANDOM': '随机',
    'SEED': '种子',
    'ENTRY': '条目',
    'RESULT': '结果',
    'SUCCESS': '成功',
    'FAIL': '失败',
    'INVALID': '无效',
    'FRIENDLY': '友方',
    'BOTH': '双方',
    'NONE': '无',
    'BASIC': '基础',
    'OTHER': '其他',
    'FLAG': '标志',
    'FLAGS': '标志',
    'ONLY': '仅',
    'MELEE': '近战',
    'RANGED': '远程',
    'DEAD': '死亡',
    'ENEMIES': '敌人',
    'ALLIES': '友军',
    'FOW': '战争迷雾',
    'INVIS': '隐身',
    'ANCIENTS': '远古',
    'PLAYER': '玩家',
    'CONTROLLED': '控制',
    'ILLUSIONS': '幻象',
    'CHECK': '检查',
    'DISABLE': '禁用',
    'HELP': '帮助',
    'PREFER': '优先',
    'RESPECT': '尊重',
    'OBSTRUCTIONS': '障碍物',
    'CATEGORY': '类别',
    'SPELL': '法术',
    'MODIFIER': '修饰器',
    'FUNCTION': '函数',
    'TOOLTIP': '提示',
    'STACKING': '叠加',
    'IGNORE': '忽略',
    'CLAMP': '限制',
    'ABSOLUTE': '绝对',
    'PERCENTAGE': '百分比',
    'ADDITIVE': '加法',
    'MULTIPLICATIVE': '乘法',
    'CALLBACK': '回调',
    'HORIZONTAL': '水平',
    'VERTICAL': '垂直',
    'MOTION': '运动',
    'CONTROLLER': '控制器',
    'PERSIST': '持续',
    'DURATION': '持续时间',
    'ABILITY': '技能',
    'DESTROY': '销毁',
    'ENEMY': '敌方',
    'ALLY': '友方',
    'DISPEL': '驱散',
    'STUN': '眩晕',
    'REPLACED': '被替换',
    'STRONG': '强',
    'DEATH': '死亡',
    'NORMAL': '正常',
    'HIGH': '高',
    'ULTRA': '超',
    'SUPER': '超级',
    'REMOVE': '移除',
    'QUEST': '任务',
    'SUBQUEST': '子任务',
    'TEXT': '文本',
    'REPLACE': '替换',
    'VALUES': '值',
    'CURRENT': '当前',
    'GOAL': '目标',
    'INITIAL': '初始',
    'ROUND': '整数',
    'SHOW': '显示',
    'GENERIC': '通用',
    'POPUP': '弹窗',
    'POSITIVE': '正面',
    'NEGATIVE': '负面',
    'BOT': '机器人',
    'INCOMING': '传入',
    'OVERLAY': '覆盖',
    'DEBUG': '调试',
    'SPHERE': '球体',
    'BOX': '盒子',
    'LINE': '线条',
    'CIRCLE': '圆',
    'CROSS': '十字',
    'TRIANGLE': '三角',
    'CAPSULE': '胶囊',
    'CONE': '锥体',
    'CYLINDER': '圆柱',
    'AXIS': '轴',
    'GRID': '网格',
    'TEXT': '文本',
    'TICK': '刻度',
    'BEHIND': '后方',
    'ELEMENTS': '元素',
    'BETWEEN': '之间',
    'HITTEST': '命中测试',
    'ABSORB': '吸收',
}

def translate_value_name(name):
    """翻译枚举值名称"""
    # 分割名称
    parts = name.split('_')
    translated_parts = []
    
    for part in parts:
        if part in WORD_MAP:
            if WORD_MAP[part]:  # 跳过空字符串（如DOTA前缀）
                translated_parts.append(WORD_MAP[part])
        elif part.isdigit():
            translated_parts.append(part)
        else:
            # 保留未识别的部分
            translated_parts.append(part)
    
    result = ''.join(translated_parts)
    
    # 如果结果为空或与原名相同，返回原名
    if not result or result == name:
        return name
    
    return result

def fix_translations():
    with open('data/luaapi/enums_cn.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    fixed_count = 0
    for item in data['items']:
        for m in item.get('members', []):
            desc = m.get('description_cn', '')
            # 检查是否包含大写英文单词（表示未完全翻译）
            if re.search(r'[A-Z]{2,}', desc):
                # 重新翻译
                new_desc = translate_value_name(m['name'])
                if new_desc != desc:
                    m['description_cn'] = new_desc
                    fixed_count += 1
    
    with open('data/luaapi/enums_cn.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print(f'修复了 {fixed_count} 个翻译')

if __name__ == '__main__':
    fix_translations()
